*** Unified proposed changes for tool-output compaction (custom format)

[See conversation for detailed diffs and rationale]

(Contents are review-only; intended to be applied with apply_patch tool or manually.)
